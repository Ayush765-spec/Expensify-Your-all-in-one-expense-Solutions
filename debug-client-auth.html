<!DOCTYPE html>
<html>
<head>
    <title>Debug Client Authentication</title>
</head>
<body>
    <h1>Clerk Authentication Debug</h1>
    <div id="output"></div>
    
    <script>
        async function testAuth() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Testing authentication...</p>';
            
            try {
                // Test API calls with different approaches
                console.log('=== Testing API Authentication from Browser ===');
                
                // Test 1: Regular fetch (should fail with 401)
                console.log('Test 1: Regular fetch to /api/transactions');
                const response1 = await fetch('/api/transactions');
                console.log('Response status:', response1.status);
                output.innerHTML += `<p>Regular fetch: ${response1.status} ${response1.statusText}</p>`;
                
                if (response1.status === 401) {
                    output.innerHTML += '<p><strong>❌ Not authenticated</strong> - This confirms the issue</p>';
                }
                
                // Test 2: Check if cookies are being sent
                console.log('Test 2: Check cookies');
                console.log('Document cookies:', document.cookie);
                output.innerHTML += `<p>Cookies: ${document.cookie ? 'Present' : 'None'}</p>`;
                
                // Test 3: Check if we're on the right domain
                console.log('Test 3: Check domain');
                console.log('Current location:', window.location.href);
                output.innerHTML += `<p>Current URL: ${window.location.href}</p>`;
                
                // Test 4: Try to access a transaction directly
                console.log('Test 4: Try to add a test transaction');
                const addResponse = await fetch('/api/add-transaction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: '2024-01-15',
                        account: 'Cash',
                        category: 'Food',
                        type: 'Expense',
                        amount: 100,
                        status: 'Cleared',
                        description: 'Test transaction'
                    })
                });
                
                console.log('Add transaction response:', addResponse.status);
                output.innerHTML += `<p>Add transaction: ${addResponse.status} ${addResponse.statusText}</p>`;
                
                if (addResponse.status === 401) {
                    output.innerHTML += '<p><strong>❌ Add transaction also not authenticated</strong></p>';
                }
                
            } catch (error) {
                console.error('Error:', error);
                output.innerHTML += `<p>Error: ${error.message}</p>`;
            }
        }
        
        // Run the test when page loads
        window.addEventListener('load', testAuth);
    </script>
</body>
</html>